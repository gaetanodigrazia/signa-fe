<div class="settings-page">

    <header class="toolbar surface">
        <div class="left">
            <h2>Impostazioni</h2>
            <p class="subtitle">Preferenze utente e studio</p>
        </div>
        <div class="right" role="toolbar">
            <button class="btn btn-ghost" type="button" (click)="reset()">Annulla</button>
            <button class="btn btn-primary" type="button" [disabled]="form.pristine || form.invalid || saving"
                (click)="save()">
                ðŸ’¾ Salva
            </button>
        </div>
    </header>


    <!-- Tabbar -->
    <nav class="tabs" role="tablist" aria-label="Sezioni impostazioni">
        <button *ngFor="let t of tabs; let i = index" class="tab" role="tab" [attr.aria-selected]="currentTab === t.key"
            [attr.aria-controls]="t.key + '-panel'" [id]="t.key + '-tab'" [class.active]="currentTab === t.key"
            (click)="setTab(t.key)" type="button">
            <span class="tab__icon" aria-hidden="true">{{ t.icon }}</span>
            <span class="tab__label">{{ t.label }}</span>
        </button>
        <!-- focus ring helper -->
        <span class="tabs__indicator" [style.transform]="indicatorTransform"></span>
    </nav>

    <!-- Panels -->
    <form [formGroup]="form" class="panels">
        <!-- PROFILO -->
        <section class="panel surface" role="tabpanel" [id]="'profile-panel'" [attr.aria-labelledby]="'profile-tab'"
            [hidden]="currentTab !== 'profile'">
            <header class="card-header">
                <h3 class="card__title">Profilo</h3>
            </header>

            <div class="grid">
                <label class="field">
                    <span>Nome</span>
                    <input type="text" formControlName="firstName" placeholder="Nome" />
                </label>

                <label class="field">
                    <span>Cognome</span>
                    <input type="text" formControlName="lastName" placeholder="Cognome" />
                </label>

                <label class="field">
                    <span>Titolo</span>
                    <input type="text" formControlName="title" placeholder="Dr., Dott.ssa, â€¦" />
                </label>

                <label class="field">
                    <span>Email</span>
                    <input type="email" formControlName="email" placeholder="nome@studio.it" />
                </label>

                <label class="field">
                    <span>Lingua</span>
                    <select formControlName="locale">
                        <option value="it-IT">Italiano</option>
                        <option value="en-GB">English (UK)</option>
                    </select>
                </label>

                <label class="field">
                    <span>Formato ora</span>
                    <select formControlName="timeFormat">
                        <option value="24h">24 ore</option>
                        <option value="12h">AM/PM</option>
                    </select>
                </label>
            </div>
        </section>

        <!-- NOTIFICHE -->
        <section class="panel surface" role="tabpanel" [id]="'notifications-panel'"
            [attr.aria-labelledby]="'notifications-tab'" [hidden]="currentTab !== 'notifications'">
            <header class="card-header">
                <h3 class="card__title">Notifiche</h3>
            </header>

            <label class="switch">
                <input type="checkbox" formControlName="notifyEmail" />
                <span>Notifiche email personali</span>
            </label>

            <label class="switch">
                <input type="checkbox" formControlName="patientReminders" />
                <span>Promemoria automatici ai pazienti (24h prima)</span>
            </label>

            <label class="field mt">
                <span>Firma email</span>
                <textarea rows="3" formControlName="emailSignature"
                    placeholder="Cordiali saluti, Dr./Dott.ssa â€¦"></textarea>
            </label>
        </section>

        <!-- AGENDA -->
        <section class="panel surface" role="tabpanel" [id]="'agenda-panel'" [attr.aria-labelledby]="'agenda-tab'"
            [hidden]="currentTab !== 'agenda'">
            <header class="card-header">
                <h3 class="card__title">Agenda e disponibilitÃ </h3>
            </header>

            <div class="grid">
                <label class="field">
                    <span>Durata visita standard</span>
                    <select formControlName="slotDuration">
                        <option value="20">20 minuti</option>
                        <option value="30">30 minuti</option>
                        <option value="45">45 minuti</option>
                        <option value="60">60 minuti</option>
                    </select>
                </label>

                <label class="field">
                    <span>Buffer tra appuntamenti</span>
                    <select formControlName="slotBuffer">
                        <option value="0">Nessuno</option>
                        <option value="5">5 minuti</option>
                        <option value="10">10 minuti</option>
                        <option value="15">15 minuti</option>
                    </select>
                </label>

                <label class="field">
                    <span>Giorni lavorativi</span>
                    <select formControlName="workingDays" multiple size="5">
                        <option *ngFor="let d of days" [value]="d.value">{{ d.label }}</option>
                    </select>
                    <small class="hint">Ctrl/Cmd + click per selezione multipla</small>
                </label>
            </div>
        </section>

        <!-- STUDIO -->
        <section class="panel surface" role="tabpanel" [id]="'clinic-panel'" [attr.aria-labelledby]="'clinic-tab'"
            [hidden]="currentTab !== 'clinic'">
            <header class="card-header">
                <h3 class="card__title">Studio e fatturazione</h3>
            </header>

            <div class="grid">
                <label class="field">
                    <span>Nome studio</span>
                    <input type="text" formControlName="clinicName" placeholder="Studio Medico â€¦" />
                </label>

                <label class="field">
                    <span>Telefono</span>
                    <input type="tel" formControlName="clinicPhone" placeholder="+39 â€¦" />
                </label>

                <label class="field">
                    <span>Indirizzo</span>
                    <input type="text" formControlName="clinicAddress" placeholder="Via, CittÃ " />
                </label>

                <label class="field">
                    <span>Partita IVA</span>
                    <input type="text" formControlName="vatId" placeholder="ITâ€¦" />
                </label>

                <label class="field">
                    <span>IBAN</span>
                    <input type="text" formControlName="iban" placeholder="IT00 A000 0000 0000 0000 0000 000" />
                </label>

                <label class="field">
                    <span>Metodi di pagamento</span>
                    <select formControlName="payments" multiple size="4">
                        <option value="cash">Contanti</option>
                        <option value="card">Carta</option>
                        <option value="bank">Bonifico</option>
                        <option value="online">Online</option>
                    </select>
                </label>
            </div>
        </section>

        <!-- PRIVACY -->
        <section class="panel surface" role="tabpanel" [id]="'privacy-panel'" [attr.aria-labelledby]="'privacy-tab'"
            [hidden]="currentTab !== 'privacy'">
            <header class="card-header">
                <h3 class="card__title">Privacy e pazienti</h3>
            </header>

            <label class="switch">
                <input type="checkbox" formControlName="gdprConsentRequired" />
                <span>Richiedi consenso privacy alla prima visita</span>
            </label>

            <label class="switch">
                <input type="checkbox" formControlName="allowPatientPortal" />
                <span>Abilita portale paziente</span>
            </label>
        </section>

        <!-- SICUREZZA -->
        <section class="panel surface" role="tabpanel" [id]="'security-panel'" [attr.aria-labelledby]="'security-tab'"
            [hidden]="currentTab !== 'security'">
            <header class="card-header">
                <h3 class="card__title">Sicurezza</h3>
            </header>

            <label class="switch">
                <input type="checkbox" formControlName="enable2fa" />
                <span>Abilita autenticazione a due fattori (2FA)</span>
            </label>

            <div class="inline-actions">
                <button type="button" class="btn-outline" (click)="changePassword()">Cambia password</button>
                <button type="button" class="btn-outline" (click)="downloadActivityLog()">Scarica log attivitÃ </button>
            </div>
        </section>

        <!-- INTEGRAZIONI -->
        <section class="panel surface" role="tabpanel" [id]="'integrations-panel'"
            [attr.aria-labelledby]="'integrations-tab'" [hidden]="currentTab !== 'integrations'">
            <header class="card-header">
                <h3 class="card__title">Integrazioni</h3>
            </header>

            <label class="switch">
                <input type="checkbox" formControlName="googleSync" />
                <span>Sincronizza calendario Google</span>
            </label>

            <label class="switch">
                <input type="checkbox" formControlName="outlookSync" />
                <span>Sincronizza calendario Outlook</span>
            </label>
        </section>

    </form>
</div>