<!-- TOGGLE SOLO SU MOBILE -->
<div *ngIf="isMobile" class="mobile-toggle">
  <button mat-button (click)="toggleMenu()">â˜° Menu</button>
</div>

<!-- SIDEBAR DESKTOP -->
<aside *ngIf="!isMobile" class="sidebar" [class.collapsed]="isCollapsed">
  <button class="collapse-toggle" (click)="toggleCollapse()" [attr.aria-expanded]="!isCollapsed"
    [attr.title]="isCollapsed ? 'Apri sidebar' : 'Comprimi sidebar'">
    <span class="hamburger-icon" aria-hidden="true">
      <span></span><span></span><span></span>
    </span>
  </button>

  <nav>
    <a routerLink="/home">
      <span class="icon">ğŸ </span>
      <span class="text" *ngIf="!isCollapsed">Home</span>
    </a>
    <div class="menu-group" [class.open]="patientsOpen">
      <button class="menu-parent" (click)="togglePatients()" [attr.aria-expanded]="patientsOpen"
        aria-controls="patients-submenu">
        <span class="icon">ğŸ‘¥</span>
        <span class="text" *ngIf="!isCollapsed">Pazienti</span>
        <span class="chevron" *ngIf="!isCollapsed" [class.rot]="patientsOpen">â–¾</span>
      </button>

      <!-- Submenu visibile solo quando la sidebar non Ã¨ collassata -->
      <div id="patients-submenu" class="submenu" *ngIf="patientsOpen && !isCollapsed">
        <a [routerLink]="['/patients']" [queryParams]="{ status: 'active' }" queryParamsHandling="merge"
          [class.active]="(status$ | async) === 'active'" (click)="closeSubmenus()">Attivi</a>

        <a [routerLink]="['/patients']" [queryParams]="{ status: 'inactive' }" queryParamsHandling="merge"
          [class.active]="(status$ | async) === 'inactive'" (click)="closeSubmenus()">Disattivi</a>
      </div>

    </div>

    <a routerLink="/calendar">
      <span class="icon">ğŸ“†</span>
      <span class="text" *ngIf="!isCollapsed">Calendario</span>
    </a>
    <a routerLink="/archive">
      <span class="icon">ğŸ—ƒï¸â€‹</span>
      <span class="text" *ngIf="!isCollapsed">â€‹Archivio</span>
    </a>
    <a routerLink="/users">
      <span class="icon">ğŸ¥â€‹</span>
      <span class="text" *ngIf="!isCollapsed">Studio</span>
    </a>
    <a routerLink="/settings">
      <span class="icon">âš™ï¸</span>
      <span class="text" *ngIf="!isCollapsed">Settings</span>
    </a>

  </nav>
  <!-- Bottoni in basso (DESKTOP) -->
  <div class="sidebar-bottom">
    <button class="logout-btn tip" (click)="logout()" title="Logout" aria-label="Logout">
      <span class="icon" aria-hidden="true">ğŸšª</span>
      <span class="text" *ngIf="!isCollapsed">Logout</span>
    </button>

  </div>

</aside>


<!-- SIDEBAR MOBILE -->
<aside *ngIf="isMobile && menuOpen" class="sidebar mobile open">
  <nav>
    <a routerLink="/home" (click)="menuOpen = false">ğŸ  Home</a>
    <div class="menu-group" [class.open]="patientsOpenMobile">
      <button class="menu-parent" (click)="patientsOpenMobile = !patientsOpenMobile"
        [attr.aria-expanded]="patientsOpenMobile" aria-controls="patients-submenu-m">
        ğŸ‘¥ Pazienti <span class="chevron" [class.rot]="patientsOpenMobile">â–¾</span>
      </button>

      <div id="patients-submenu-m" class="submenu" *ngIf="patientsOpenMobile">
        <a [routerLink]="['/patients']" [queryParams]="{ status: 'active' }" queryParamsHandling="merge"
          [class.active]="(status$ | async) === 'active'" (click)="closeMobileMenu()">Attivi</a>

        <a [routerLink]="['/patients']" [queryParams]="{ status: 'inactive' }" queryParamsHandling="merge"
          [class.active]="(status$ | async) === 'inactive'" (click)="closeMobileMenu()">Disattivi</a>
      </div>

    </div>
    <a routerLink="/calendar" (click)="menuOpen = false">ğŸ“† Calendario</a>
    <a routerLink="/archive" (click)="menuOpen = false">ğŸ—ƒï¸â€‹ Archivio</a>


    <a routerLink="/users" (click)="menuOpen = false">ğŸ¥â€‹ Studio</a>

    <a routerLink="/settings" (click)="menuOpen = false">âš™ï¸ Settings</a>
  </nav>
  <!-- Bottoni in basso (MOBILE) -->
  <div class="sidebar-bottom">
    <button class="logout-btn tip" (click)="logout()" title="Logout" aria-label="Logout">
      <span class="icon" aria-hidden="true">ğŸšª</span>
      <span class="text" *ngIf="!isCollapsed">Logout</span>
    </button>

  </div>

</aside>